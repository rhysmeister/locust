---
- hosts: all
  become: true

  tasks:

  - name: Ensure epel repo is available
    yum:
      name: epel-release
      state: installed

  - name: Ensure pip is installed
    yum:
      name: python2-pip
      state: latest

  - name: Ensure locustio is installed
    pip:
      name: locustio
      state: latest

  - name: Ensure locust user exists
    user:
      name: locust
      state: present

  - name: Ensure limits for locust user are set
    pam_limits:
      domain: locust
      limit_type: "-"
      limit_item: nofile
      value: 10000
